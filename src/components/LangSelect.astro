---
import { getRelativeLocaleUrl } from "astro:i18n";

const currentLang = Astro.currentLocale ?? "fr"; // default fr
const targetLang = currentLang === "fr" ? "en" : "fr";

// Obtener el pathname actual y remover el base
const base = import.meta.env.BASE_URL;
let pathname = Astro.url.pathname;

// Remover el base del pathname (ej: "/100/" -> "/" o "/100/en/" -> "/en/")
if (pathname.startsWith(base)) {
  pathname = pathname.slice(base.length - 1); // -1 para mantener el / inicial
}

// Remover el prefijo del locale si existe (/en o /fr)
// Esto deja solo el pathname relativo sin locale (ej: "/" o "/some-page")
pathname = pathname.replace(/^\/(en|fr)(\/|$)/, "/") || "/";

// Asegurarse de que empiece con /
if (!pathname.startsWith("/")) {
  pathname = "/" + pathname;
}

// getRelativeLocaleUrl genera la URL correcta con el base y locale
// Ejemplo: getRelativeLocaleUrl("en", "/") -> "/100/en/"
const targetUrl = getRelativeLocaleUrl(targetLang as "en" | "fr", pathname);
---
<a href={targetUrl}>{targetLang}</a>

---
import Button from "./Button.astro";
import Fecha from "./Fecha.astro";
import ModalEvento from "./ModalEvento.astro";

interface Props {
  imageUrl: string;
  title: string;
  excerpt: string;
  postId: number;
  contenidoCompleto: string;
  pdfUrl?: string;
  fechaEvento?: string;
  subcategoria?: string;
}

const {
  imageUrl,
  title,
  excerpt,
  postId,
  contenidoCompleto,
  pdfUrl,
  fechaEvento,
  subcategoria,
} = Astro.props;
---

<div id="cardEventoSec" data-post-id={postId}>
  <div class="date">
    {fechaEvento && <Fecha fecha={fechaEvento} />}
  </div>
  <h3>{title}</h3>
  <div class="sub">
    {subcategoria && <span class="categoria">üè∑Ô∏è {subcategoria}</span>}
  </div>
   <p set:html={excerpt} />

   <div class="der">
    <div class="ico">
        Aqui el icono segun <sub>sub</sub>
    </div>
      <div id="elbtn">
    <Button
      text="d√©tails"
      icon="mdi:chevron-right"
      type="button"
      onclick={`document.querySelector('[data-post-id="${postId}"] .modal-wrapper').classList.add('visible')`}
    />
  </div>
   </div>
   
   <div class="modal-wrapper" data-modal={postId}>
       <ModalEvento
       isOpen={true}
       title={title}
       imageUrl={imageUrl}
       contenidoCompleto={contenidoCompleto}
       pdfUrl={pdfUrl}
       fechaEvento={fechaEvento}
       subcategoria={subcategoria}
       onClose={() => {}}
       />
    </div>
</div>

  
<style lang="scss">
  @use "/src/styles/variables.scss" as *;



  .modal-wrapper {
    :global(.modal) {
      display: none;
    }

    &.visible :global(.modal) {
      display: flex !important;
    }
  }
</style>

<script define:vars={{ postId }}>
  // Script para manejar el cierre del modal
  document.addEventListener("click", (e) => {
    const wrapper = document.querySelector(
      `[data-post-id="${postId}"] .modal-wrapper`
    );
    if (!wrapper) return;

    const modal = wrapper.querySelector(".modal");

    // Cerrar si clickea en el fondo (fuera del contenido)
    if (e.target === modal) {
      wrapper.classList.remove("visible");
    }

    // Cerrar si clickea la X
    if (e.target.classList.contains("cerrar")) {
      wrapper.classList.remove("visible");
    }
  });
</script>

